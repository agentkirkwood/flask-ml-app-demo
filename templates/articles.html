{% extends 'base.html' %}

{% block title %}Articles Database{% endblock %}

{% block extra_head %}
  <style>
    .article-card {
      transition: box-shadow 0.3s ease;
    }
    .article-card:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
  </style>
{% endblock %}

{% block content %}
  <div class="my-2">
    <h1>Articles Database</h1>
    <p class="lead">Browse all articles in our collection</p>
  </div>

    <div class="row mb-4">
      <div class="col-lg-8">
        <form method="get" action="/articles" class="d-flex gap-2">
          <input type="text" name="q" class="form-control" placeholder="Search headlines, body, author, publisher..." value="{{ query_text }}">
          <select name="per_page" class="form-select" style="max-width: 140px;">
            <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
            <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
            <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
            <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
          </select>
          <button type="submit" class="btn btn-primary">Search</button>
          {% if query_text %}
            <a href="/articles" class="btn btn-outline-secondary">Clear</a>
          {% endif %}
        </form>
      </div>
      <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
        <div class="text-muted">
          Showing {{ articles|length }} of {{ total }} results
        </div>
      </div>
    </div>
    
    <div class="row">
      {% if articles %}
        {% for article in articles %}
        <div class="col-md-12 mb-3">
          <div class="card article-card">
            <div class="card-body">
              <h5 class="card-title">
                <a href="/articles/{{ article.id }}" class="text-decoration-none">
                  {{ article.headline or 'Untitled' }}
                </a>
              </h5>
              <div class="card-text">
                <p class="mb-1">
                  <strong>Published:</strong> 
                  {% if article.pub_date %}
                    {{ article.pub_date.strftime('%B %d, %Y') }}
                  {% else %}
                    Unknown
                  {% endif %}
                </p>
                <p class="mb-1">
                  <strong>Author:</strong> {{ article.author_name or 'Unknown' }}
                </p>
                <p class="mb-1">
                  <strong>Publisher:</strong> {{ article.publisher_name or 'Unknown' }}
                </p>
              </div>
              <a href="/articles/{{ article.id }}" class="btn btn-primary btn-sm mt-2">Read Full Article</a>
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="col-md-12">
          <div class="alert alert-info">
            No articles found in the database.
          </div>
        </div>
      {% endif %}
    </div>

    {% if total_pages > 1 %}
    <nav aria-label="Articles pagination" class="mt-4">
      <ul class="pagination justify-content-center">
        <li class="page-item {% if page <= 1 %}disabled{% endif %}">
          <a class="page-link" href="/articles?page={{ page - 1 }}&per_page={{ per_page }}{% if query_text %}&q={{ query_text|urlencode }}{% endif %}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>

        {% for p in range(1, total_pages + 1) %}
          {% if p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
            <li class="page-item {% if p == page %}active{% endif %}">
              <a class="page-link" href="/articles?page={{ p }}&per_page={{ per_page }}{% if query_text %}&q={{ query_text|urlencode }}{% endif %}">{{ p }}</a>
            </li>
          {% elif p == page - 3 or p == page + 3 %}
            <li class="page-item disabled"><span class="page-link">â€¦</span></li>
          {% endif %}
        {% endfor %}

        <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
          <a class="page-link" href="/articles?page={{ page + 1 }}&per_page={{ per_page }}{% if query_text %}&q={{ query_text|urlencode }}{% endif %}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
    {% endif %}
{% endblock %}
